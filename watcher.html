<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LayerZero TX Watcher (Auto-Refresh)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg1:#0e1510; --bg2:#0a120b;
    --card:#101910; --muted:#203520; --field:#0c150d;
    --acc1:#22c55e; --acc2:#16a34a; --txt:#e8f3e9; --sub:#a9c7af;
  }
  body {
    margin:0; font-family:'Poppins',system-ui,Arial; min-height:100vh;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: radial-gradient(circle at 20% -20%, var(--bg1), var(--bg2) 60%);
    color:var(--txt); padding:60px 12px;
  }
  .card {
    width:min(420px,95vw);
    background:linear-gradient(180deg,rgba(16,25,16,.9),rgba(12,19,12,.9));
    border:1px solid var(--muted); border-radius:16px; padding:22px;
    box-shadow:0 12px 24px rgba(0,0,0,.35); text-align:center;
  }
  h2{margin:0 0 12px;color:var(--acc1)}
  input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--muted);background:var(--field);color:#fff;font-size:14px}
  button{width:100%;margin-top:10px;padding:12px;border:0;border-radius:10px;font-weight:700;cursor:pointer;
    color:#06110a;background:linear-gradient(90deg,var(--acc1),var(--acc2));transition:.2s}
  button.secondary{background:#203820;color:#bfe8c2}
  pre{background:var(--field);border:1px solid var(--muted);border-radius:10px;padding:10px;margin-top:12px;
    white-space:pre-wrap;font-size:13px;text-align:left;color:#dff8e6;}
  footer{margin-top:16px;font-size:12px;color:#8fcfa0}
</style>
</head>
<body>
<div class="card">
  <h2>üõ∞Ô∏è LayerZero TX Watcher</h2>
  <input id="tx" placeholder="Masukkan TX hash (0x...)" />
  <button id="btnCheck">üîç Cek Sekali</button>
  <button id="btnToggle" class="secondary">üõ∞Ô∏è Auto-Poll: OFF</button>
  <pre id="log">log siap...</pre>
  <footer>by thdx</footer>
</div>

<script>
const $ = id => document.getElementById(id);
const log = m => { $("log").textContent += "\n" + m; $("log").scrollTop = $("log").scrollHeight; };

let polling = false, timer = null;

async function fetchText(u){ const r=await fetch(u,{mode:"cors"}); if(!r.ok) throw new Error(`HTTP ${r.status}`); return await r.text(); }
async function fetchJson(u){ const r=await fetch(u,{mode:"cors"}); if(!r.ok) throw new Error(`HTTP ${r.status}`); return await r.json(); }

async function checkStatus(manual=false){
  try{
    if(manual) $("log").textContent="‚è≥ Mengecek status...";
    const tx=$("tx").value.trim();
    if(!/^0x[0-9a-fA-F]{64}$/.test(tx)) return log("‚ö†Ô∏è TX hash tidak valid.");

    const htmlUrls=[
      `https://testnet.layerzeroscan.com/tx/${tx}`,
      `https://api.testnet.layerzeroscan.com/tx/${tx}`,
      `https://api-testnet.layerzeroscan.com/tx/${tx}`
    ];

    // 1Ô∏è‚É£ coba JSON endpoint dulu
    for(const api of [
      `https://api.testnet.layerzeroscan.com/api/tx/${tx}`,
      `https://api-testnet.layerzeroscan.com/api/tx/${tx}`
    ]){
      try{
        const js = await fetchJson(api);
        if(js?.status){
          log(`‚úÖ JSON API: ${api}`);
          log(`üì¶ status: ${js.status}`);
          return;
        }
      }catch{}
    }

    // 2Ô∏è‚É£ fallback ke HTML
    let html=null;
    for(const u of htmlUrls){ try{ html=await fetchText(u); break; }catch{} }
    if(!html){ return log("‚ùå Gagal fetch dari semua endpoint."); }

    let status="‚ùì Tidak diketahui / TX belum teregistrasi di LayerZeroScan.";
    if(/Delivered/i.test(html)) status="‚úÖ Delivered (pesan sudah diterima)";
    else if(/Inflight/i.test(html)) status="üïê Inflight (pesan sedang diproses)";
    else if(/Failed/i.test(html)) status="‚ùå Failed (pesan gagal / timeout)";

    log(status);
  }catch(e){ log("‚ùå Error: "+(e.message||e)); }
}

function togglePoll(){
  polling=!polling;
  $("btnToggle").textContent = polling ? "üõ∞Ô∏è Auto-Poll: ON (30s)" : "üõ∞Ô∏è Auto-Poll: OFF";
  $("btnToggle").classList.toggle("secondary", !polling);
  if(timer){ clearInterval(timer); timer=null; }
  if(polling){
    checkStatus(true);
    timer=setInterval(()=>checkStatus(false), 30000);
    log("üïí Auto-poll dimulai, interval 30 detik...");
  }else{
    log("üõë Auto-poll dihentikan.");
  }
}

$("btnCheck").onclick = ()=>checkStatus(true);
$("btnToggle").onclick = togglePoll;
</script>
</body>
</html>
